10000 REM ************ sum.rtn 02/12/2010 09:50:00 ************ 
55555 REM Please keep line 10000 updated when changes are made. Volodya Savastiouk
10001 REM  MKII/MKIII/MKIV Daily Summary File Creation From Data File
10002 REM
10004 REM ************************************************************
10005 DATA sum
10010 EZ%=0:GG=0:ON ERROR GOTO 11000
10020 FLAG=0:GOTO 30000
11000 REM error handler on file open
11010 PRINT#4,"No data file available for this day.":REM if problem
11020 PRINT#4,:RESUME 11030
11030 ON ERROR GOTO 3100
11040 CLOSE 8:CLOSE 6:RETURN
30000 REM -30050 open daily data file and daily summary file
30010 CLOSE 8:OPEN DD$+HD$+JD$+YF$+"."+NO$ FOR INPUT AS 8
30020 CLOSE 6:OPEN DD$+"S"+JD$+YF$+"."+NO$ FOR OUTPUT AS 6
30030 PRINT#6,"tc":FOR I=2 TO 7:PRINT#6,TC(I):NEXT
30040 print#6,"n2tc":for i=2 to 7:print#6,ntc(i):next
30050 :
30060 REM -30410 select summary data from daily data file
30065 IF EZ%=1 THEN EZ%=0:GOTO 30200
30067 IF EOF(8) THEN 30200
30070 INPUT#8,A$:IF left$(A$,8)="version=" THEN FLAG=VAL(MID$(A$,9))
30080 IF A$="um" THEN GOSUB 30240
30090 IF right$(A$,7) ="summary" THEN PRINT#6,A$:GOTO 30140
30120 IF right$(A$,2) ="hg" THEN PRINT#6,A$:GOTO 30190
30130 GOTO 30065
30140 INPUT#8,H$:REM get time
30150 PRINT#6,H$
30160 FOR I=1 TO 24:IF EOF(8) THEN EZ%=1:GOTO 30175
30170 INPUT#8,A$
30175 PRINT#6,A$
30180 NEXT:GOTO 30065
30190 FOR I=1 TO 6:IF EOF(8) THEN EZ%=1:GOTO 30197
30195 INPUT#8,A$
30197 PRINT#6,A$:NEXT:GOTO 30065
30200 PRINT#6,A$:PRINT#6,"ef":CLOSE 6:CLOSE 8:IF GG=1 THEN PRINT#9,"ef":CLOSE 9
30205 GG=0:GOSUB 2500:RETURN 
30219 :
30240 REM -30410 record umkehr summary on disk
30250 QQ=1/LOG(10)
30260 IF GG=0 THEN OPEN DD$+"U"+JD$+YF$+"."+NO$ FOR OUTPUT AS 9:GG=1
30265 IF EOF(8) THEN EZ%=1:GOTO 39285
30270 INPUT#8,D1$,D2$,D3$,Z$,Z$,Z$,V,Z$,Z$,S$,AA
30275 IF EOF(8) THEN EZ%=1:GOTO 39285
30280 INPUT#8,Z$,Z$,BB:IF FLAG=1 THEN INPUT#8,I:REM slit#0 added in ver 1 only
30285 INPUT#8,DC,C1,C2,C3,C4,C5:D1$=RIGHT$(STR$(VAL(D1$)+100),2)
30290 V=INT(100*(V+.005))+1000:V$=RIGHT$(STR$(V),3)
30300 EP=1.000005:IF AA<1 THEN AA=1
30305 AA=INT(100000!*(QQ*LOG(AA)+EP))
30310 IF DC<1 THEN DC=1
30315 DC=INT(100000!*(QQ*LOG(DC)+EP))
30320 IF C1<1 THEN C1=1
30325 C1=INT(100000!*(QQ*LOG(C1)+EP))
30330 IF C2<1 THEN C2=1
30335 C2=INT(100000!*(QQ*LOG(C2)+EP))
30340 IF C3<1 THEN C3=1
30345 C3=INT(100000!*(QQ*LOG(C3)+EP))
30350 IF C4<1 THEN C4=1
30355 C4=INT(100000!*(QQ*LOG(C4)+EP))
30360 IF C5<1 THEN C5=1
30365 C5=INT(100000!*(QQ*LOG(C5)+EP))
30370 PRINT#9,D1$;D2$;D3$;" ";V$;" ";S$;AA;BB;DC;C1;C2;C3;C4;C5
30380 RETURN 
65529 DATA proper last line
