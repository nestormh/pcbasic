10000 REM ************ ab_sk.rtn 02/12/2010 09:50:00 ************ 
55555 REM Please keep line 10000 updated when changes are made. Volodya Savastiouk
55555 REM             MKII/MKIII/MKIV Abort Schedule Routine
10002 REM		added "home pressed message" - Volodya
10003 REM
10004 REM **************************************************************
10010 DATA ab_sk
12010 ON ERROR GOTO 30000:CLOSE 8
12020 OPEN DD$+"B"+JD$+YF$+"."+NO$ FOR INPUT AS 8
12030 ON ERROR GOTO 31000
12040 IF EOF(8) THEN 12200
12050   INPUT#8,A$:IF A$="co" THEN INPUT#8,A$, A$: PRINT A$: GOSUB 13000 ELSE UV%=0
12060   GOTO 12040
12200 '
12210 ON ERROR GOTO 3100:CLOSE 8
12999 GOTO 32000
13000 IF INSTR( A$, "scan started" ) <> 0 THEN UV%=1: RETURN
13010 IF INSTR( A$, "ab_sk" ) = 0 THEN UV%=0
13100 RETURN
30000 '
30001 ' *** Error Handler on File Open ***
30002 '
30010 PRINT "No Brewer (B) file available for this day."
30020 RESUME 30030
30030 X=1:GOSUB 7220:ON ERROR GOTO 3100:CLOSE 8:RETURN
31000 '
31001 ' *** Generic Error Handler ***
31002 '
31010 GOTO 3100
32000 ED%=1:PRINT CL$:IF UV%=1 THEN AUTOHG = 1:NEED.FR=1
32010 LOCATE 10,SP:PRINT "Observations were last interrupted from"
32020 LOCATE 11,SP:PRINT SK$;" schedule in ";DI$;" routine."
32030 LOCATE 13,SP:PRINT "Schedule will resume in     seconds"
32040 LOCATE 14,SP:PRINT "unless you press HOME for main menu"
32050 TA=900:GOSUB 7050
32060 TI=TIMER*60:LOCATE 13,SP+24:PRINT RIGHT$("   "+STR$(INT((TA-TI)/60+1)),2)
32070 IF TI>TA THEN PRINT CL$:G$(0)=DI$:RETURN
32080 A$=INKEY$:IF A$<>Q2$ THEN 32060
32090 PRINT CL$:SK$="":DI$="menu": B$ = "HOME key pressed": GOSUB 3050:GOSUB 5200:RETURN
65529 REM proper last line

